<!DOCTYPE html>
<html>
<head>
    <title>Quick Authentication Setup</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        .container { max-width: 600px; }
        button { padding: 10px 20px; margin: 10px 0; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .success { color: green; }
        .error { color: red; }
        .info { background: #f8f9fa; padding: 15px; border-radius: 4px; margin: 10px 0; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 4px; overflow-x: auto; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Quick Authentication Setup</h1>
        
        <div class="info">
            <strong>Purpose:</strong> This tool sets up a valid authentication token in your browser's localStorage 
            so the frontend can make authenticated API calls to the backend.
        </div>

        <h2>Step 1: Set Authentication Token</h2>
        <button onclick="setupAuthToken()">Set Authentication Token</button>
        <div id="tokenResult"></div>

        <h2>Step 2: Test Authentication</h2>
        <button onclick="testAuthentication()">Test API Call</button>
        <div id="testResult"></div>

        <h2>Step 3: Debug Information</h2>
        <button onclick="showDebugInfo()">Show Debug Info</button>
        <div id="debugResult"></div>

        <h2>Manual Instructions</h2>
        <div class="info">
            <p>If the buttons above don't work, you can manually run this in your browser console:</p>
            <pre>
// Set the authentication token
localStorage.setItem('karen_access_token', 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI4YTMyZmQzZC05NGYwLTRmZjgtODE0Yi1lZWYzOTQyYTI3ZDkiLCJlbWFpbCI6ImFkbWluQGV4YW1wbGUuY29tIiwiZnVsbF9uYW1lIjoiQWRtaW4gVXNlciIsInJvbGVzIjpbXSwidGVuYW50X2lkIjoiZmMwY2ExOTQtYTkxYS00NjA1LWE4OWUtMDkzNDQ3ODEyMTM1IiwiaXNfdmVyaWZpZWQiOnRydWUsImlzX2FjdGl2ZSI6dHJ1ZSwiZXhwIjoxNzU2NzQyNDE5LCJpYXQiOjE3NTY3NDE1MTksIm5iZiI6MTc1Njc0MTUxOSwianRpIjoiZTUzNTBkNGE0YzEyYTUyZTQ4ZjY2MzkzOTUxMWVkNDgiLCJ0eXAiOiJhY2Nlc3MifQ.lIeHeeaYxHJtks4-0iL_cNEvf3iUFOUyivc8YaH8lB0');

// Set session data
localStorage.setItem('karen_session_data', JSON.stringify({
  userId: '8a32fd3d-94f0-4ff8-814b-eef3942a27d9',
  email: 'admin@example.com',
  expiresAt: Date.now() + (24 * 60 * 60 * 1000),
  roles: [],
  tenantId: 'fc0ca194-a91a-4605-a89e-093447812135'
}));

// Refresh the page
location.reload();
            </pre>
        </div>
    </div>

    <script>
        const TEST_TOKEN = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI4YTMyZmQzZC05NGYwLTRmZjgtODE0Yi1lZWYzOTQyYTI3ZDkiLCJlbWFpbCI6ImFkbWluQGV4YW1wbGUuY29tIiwiZnVsbF9uYW1lIjoiQWRtaW4gVXNlciIsInJvbGVzIjpbXSwidGVuYW50X2lkIjoiZmMwY2ExOTQtYTkxYS00NjA1LWE4OWUtMDkzNDQ3ODEyMTM1IiwiaXNfdmVyaWZpZWQiOnRydWUsImlzX2FjdGl2ZSI6dHJ1ZSwiZXhwIjoxNzU2NzQyNDE5LCJpYXQiOjE3NTY3NDE1MTksIm5iZiI6MTc1Njc0MTUxOSwianRpIjoiZTUzNTBkNGE0YzEyYTUyZTQ4ZjY2MzkzOTUxMWVkNDgiLCJ0eXAiOiJhY2Nlc3MifQ.lIeHeeaYxHJtks4-0iL_cNEvf3iUFOUyivc8YaH8lB0';

        function setupAuthToken() {
            try {
                // Set the authentication token
                localStorage.setItem('karen_access_token', TEST_TOKEN);
                
                // Set session data
                localStorage.setItem('karen_session_data', JSON.stringify({
                    userId: '8a32fd3d-94f0-4ff8-814b-eef3942a27d9',
                    email: 'admin@example.com',
                    expiresAt: Date.now() + (24 * 60 * 60 * 1000), // 24 hours from now
                    roles: [],
                    tenantId: 'fc0ca194-a91a-4605-a89e-093447812135'
                }));

                document.getElementById('tokenResult').innerHTML = 
                    '<div class="success">‚úÖ Authentication token set successfully!</div>' +
                    '<p>Token preview: ' + TEST_TOKEN.substring(0, 50) + '...</p>' +
                    '<p><strong>Next:</strong> Refresh your main application page to apply the authentication.</p>';
                
                console.log('‚úÖ Authentication token set successfully!');
            } catch (error) {
                document.getElementById('tokenResult').innerHTML = 
                    '<div class="error">‚ùå Failed to set token: ' + error.message + '</div>';
                console.error('Failed to set token:', error);
            }
        }

        function testAuthentication() {
            const token = localStorage.getItem('karen_access_token');
            if (!token) {
                document.getElementById('testResult').innerHTML = 
                    '<div class="error">‚ùå No token found. Please set the token first.</div>';
                return;
            }

            // Test the token by making a request to the backend through Next.js proxy
            fetch('/api/auth/me', {
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json'
                }
            })
            .then(response => {
                if (response.ok) {
                    return response.json();
                } else {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
            })
            .then(data => {
                document.getElementById('testResult').innerHTML = 
                    '<div class="success">‚úÖ Authentication test successful!</div>' +
                    '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
                console.log('‚úÖ Authentication test successful:', data);
            })
            .catch(error => {
                document.getElementById('testResult').innerHTML = 
                    '<div class="error">‚ùå Authentication test failed: ' + error.message + '</div>' +
                    '<p>This might be normal if you\'re not on the main application domain.</p>';
                console.error('‚ùå Authentication test failed:', error);
            });
        }

        function showDebugInfo() {
            const token = localStorage.getItem('karen_access_token');
            const sessionData = localStorage.getItem('karen_session_data');
            
            let debugInfo = '<h3>Current Authentication State:</h3>';
            
            if (token) {
                debugInfo += '<div class="success">‚úÖ Token found in localStorage</div>';
                debugInfo += '<p>Token length: ' + token.length + ' characters</p>';
                debugInfo += '<p>Token preview: ' + token.substring(0, 50) + '...</p>';
            } else {
                debugInfo += '<div class="error">‚ùå No token found in localStorage</div>';
            }
            
            if (sessionData) {
                debugInfo += '<div class="success">‚úÖ Session data found</div>';
                try {
                    const parsed = JSON.parse(sessionData);
                    debugInfo += '<pre>' + JSON.stringify(parsed, null, 2) + '</pre>';
                } catch (e) {
                    debugInfo += '<div class="error">‚ùå Invalid session data format</div>';
                }
            } else {
                debugInfo += '<div class="error">‚ùå No session data found</div>';
            }
            
            debugInfo += '<h3>Instructions:</h3>';
            debugInfo += '<ol>';
            debugInfo += '<li>If no token is found, click "Set Authentication Token" above</li>';
            debugInfo += '<li>Go back to your main application (http://localhost:8010)</li>';
            debugInfo += '<li>Refresh the page</li>';
            debugInfo += '<li>The 401 errors should be resolved</li>';
            debugInfo += '</ol>';
            
            document.getElementById('debugResult').innerHTML = debugInfo;
        }

        // Auto-show debug info on page load
        window.onload = function() {
            showDebugInfo();
        };
    </script>
</body>
</html>